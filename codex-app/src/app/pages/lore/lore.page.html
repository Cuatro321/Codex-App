<ion-header translucent="true">
  <ion-toolbar class="nexo-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="nexo-brand">CÃ³dex del Nexo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen="true">
  <div class="ion-padding">
    <!-- Intro -->
    <div class="codex-card codex-card--intro">
      <h2 class="codex-title">CÃ³dex del Nexo</h2>
      <p class="codex-subtitle">
        Historias, personajes, enemigos, dominios, artefactos y guÃ­as
        estratÃ©gicas. Todo el lore y contenido jugable en un solo lugar.
      </p>
    </div>

    <!-- Ãšltimas historias -->
    <div class="codex-card codex-card--stories">
      <div class="codex-card-header">
        <h3>ðŸ“– Ãšltimas historias</h3>
        <p>Fragmentos recientes sincronizados desde el CÃ³dex.</p>
      </div>

      <ng-container
        *ngIf="historias$ | async as historias; else loadingHistorias"
      >
        <ion-list class="codex-list">
          <ion-item
            *ngFor="let h of historias"
            class="codex-story-item"
            detail="false"
            (click)="openStoryDetail(h)"
          >
            <ion-thumbnail slot="start" *ngIf="h.coverImageUrl">
              <img [src]="h.coverImageUrl" [alt]="h.title" />
            </ion-thumbnail>

            <ion-label>
              <h2>{{ h.title }}</h2>
              <p>{{ h.summary }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ng-container>

      <ng-template #loadingHistorias>
        <p class="codex-loading">Cargando historias...</p>
      </ng-template>
    </div>
  </div>

  <!-- MODAL DETALLE HISTORIA -->
  <ion-modal
    [isOpen]="storyModalOpen"
    (didDismiss)="closeStoryModal()"
    class="story-modal"
  >
    <ng-template>
      <ion-header translucent="true">
        <ion-toolbar class="story-modal-toolbar">
          <ion-buttons slot="start">
            <ion-button fill="clear" (click)="closeStoryModal()">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title class="story-modal-title">
            {{ selectedStory?.title || 'Historia' }}
          </ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="story-modal-content" fullscreen="true">
        <div class="story-modal-inner" *ngIf="selectedStory as story">
          <!-- Hero -->
          <div class="story-hero">
            <ng-container *ngIf="story.coverImageUrl; else heroFallback">
              <div class="story-cover">
                <img [src]="story.coverImageUrl" [alt]="story.title" />
              </div>
            </ng-container>

            <ng-template #heroFallback>
              <div class="story-cover story-cover--fallback">
                <ion-icon name="book-outline"></ion-icon>
              </div>
            </ng-template>

            <div class="story-hero-text">
              <h2>{{ story.title }}</h2>
              <p class="story-summary">
                {{ story.summary }}
              </p>
            </div>
          </div>

          <!-- Body -->
          <div class="story-body-card">
            <p class="story-body">
              {{ story.body }}
            </p>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
