<ion-header translucent="true">
  <ion-toolbar class="nexo-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title class="nexo-brand">Enemigos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen="true">
  <div class="ion-padding">
    <!-- Cabecera -->
    <div class="codex-card">
      <h2 class="codex-title">Amenazas del Nexo</h2>
      <p class="codex-subtitle">
        Comportamientos y sprites sincronizados desde el Códex del sitio.
      </p>
    </div>

    <!-- Lista de enemigos (tarjetas de mismo tamaño) -->
    <div class="grid-cards">
      <ng-container *ngIf="enemigos$ | async as enemigos; else loading">
        <div
          class="enemy-card"
          *ngFor="let e of enemigos"
          (click)="openEnemyDetail(e)"
        >
          <div class="enemy-main">
            <div class="enemy-avatar" *ngIf="e.spriteGifUrl || e.spriteStillUrl || e.imageFullUrl">
              <img
                [src]="e.spriteGifUrl || e.spriteStillUrl || e.imageFullUrl"
                [alt]="e.name"
              />
            </div>

            <div class="enemy-info">
              <h3>{{ e.name }}</h3>
              <p class="enemy-meta">
                Dominio: {{ e.domainId || 'desconocido' }}
              </p>
              <p class="enemy-text">
                {{ e.description || 'Sin descripción' }}
              </p>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #loading>
        <p class="enemy-loading">Cargando enemigos...</p>
      </ng-template>
    </div>
  </div>

  <!-- MODAL DETALLE ENEMIGO -->
  <ion-modal
    [isOpen]="enemyModalOpen"
    (didDismiss)="closeEnemyModal()"
    class="enemy-modal"
  >
    <ng-template>
      <ion-header translucent="true">
        <ion-toolbar class="enemy-modal-toolbar">
          <ion-buttons slot="start">
            <ion-button fill="clear" (click)="closeEnemyModal()">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title class="enemy-modal-title">
            {{ selectedEnemy?.name || 'Enemigo' }}
          </ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="enemy-modal-content" fullscreen="true">
        <div class="enemy-modal-inner" *ngIf="selectedEnemy as en">

          <!-- HERO -->
          <div class="enemy-hero">
            <div class="enemy-portrait">
              <ng-container *ngIf="en.spriteStillUrl || en.spriteGifUrl || en.imageFullUrl; else portraitFallback">
                <img
                  [src]="en.spriteStillUrl || en.spriteGifUrl || en.imageFullUrl"
                  [alt]="en.name"
                />
              </ng-container>
              <ng-template #portraitFallback>
                <ion-icon name="skull-outline"></ion-icon>
              </ng-template>
            </div>

            <div class="enemy-hero-text">
              <h2>{{ en.name }}</h2>
              <div class="enemy-tags">
                <span class="enemy-tag enemy-tag--domain">
                  {{ en.domainId || 'Dominio desconocido' }}
                </span>
                <span class="enemy-tag enemy-tag--slug" *ngIf="en.slug">
                  {{ en.slug }}
                </span>
              </div>
            </div>
          </div>

          <!-- COMPORTAMIENTO -->
          <div class="enemy-section-card" *ngIf="en.behavior">
            <div class="enemy-section-header">
              <ion-icon name="trail-sign-outline"></ion-icon>
              <span>Comportamiento</span>
            </div>
            <p class="enemy-section-text">
              {{ en.behavior }}
            </p>
          </div>

          <!-- SPRITE GIF -->
          <div class="enemy-gif-card" *ngIf="en.spriteGifUrl">
            <div class="enemy-section-header">
              <ion-icon name="flame-outline"></ion-icon>
              <span>Sprite animado</span>
            </div>
            <div class="enemy-gif-frame">
              <img [src]="en.spriteGifUrl" [alt]="en.name + ' sprite gif'" />
            </div>
          </div>

          <!-- IMAGEN FULL -->
          <div class="enemy-image-card" *ngIf="en.imageFullUrl">
            <div class="enemy-section-header">
              <ion-icon name="image-outline"></ion-icon>
              <span>Arte completo</span>
            </div>
            <div class="enemy-image-frame">
              <img [src]="en.imageFullUrl" [alt]="en.name + ' arte completo'" />
            </div>
          </div>

          <!-- DESCRIPCIÓN -->
          <div class="enemy-section-card enemy-desc-card">
            <div class="enemy-section-header">
              <ion-icon name="book-outline"></ion-icon>
              <span>Descripción</span>
            </div>
            <p class="enemy-section-text">
              {{ en.description || 'Sin descripción disponible.' }}
            </p>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
